
<style>
  #shopify-section-{{ section.id }} {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    z-index: 9999;
    background-color: {{ section.settings.background }} !important;
    border-top: 1px solid {{ section.settings.border_color }} !important;
    padding-bottom: env(safe-area-inset-bottom);
    display: none;
    {% if section.settings.show_shadow %}
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    {% endif %}
  }

  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} {
      display: {% if section.settings.enable %}block{% else %}none{% endif %};
    }
    {% if section.settings.enable %}
    body {
      padding-bottom: calc({{ section.settings.height }}px + env(safe-area-inset-bottom));
    }
    {% endif %}
  }

  #shopify-section-{{ section.id }} .bottom-nav {
    display: flex;
    justify-content: space-around;
    align-items: center;
    height: {{ section.settings.height }}px;
    padding: 0 10px;
  }

  #shopify-section-{{ section.id }} .bottom-nav__item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: {{ section.settings.text_color }} !important;
    font-size: {{ section.settings.font_size }}px;
    background: none;
    border: none;
    cursor: pointer;
    flex: 1;
    padding: 5px 0;
    gap: 4px;
    line-height: 1.2;
    transition: color 0.2s ease;
  }

  #shopify-section-{{ section.id }} .bottom-nav__item:hover,
  #shopify-section-{{ section.id }} .bottom-nav__item.active {
    color: {{ section.settings.active_color }} !important;
  }

  /* Force svg to inherit color from parent */
  #shopify-section-{{ section.id }} .bottom-nav__item .icon,
  #shopify-section-{{ section.id }} .bottom-nav__item svg {
    width: {{ section.settings.icon_size }}px;
    height: {{ section.settings.icon_size }}px;
    color: {{ section.settings.icon_color }} !important;
    fill: currentColor;
    stroke: currentColor;
    transition: color 0.2s ease;
  }
  
  /* Ensure active/hover state also applies to icon */
  #shopify-section-{{ section.id }} .bottom-nav__item:hover .icon,
  #shopify-section-{{ section.id }} .bottom-nav__item.active .icon,
  #shopify-section-{{ section.id }} .bottom-nav__item:hover svg,
  #shopify-section-{{ section.id }} .bottom-nav__item.active svg {
    color: {{ section.settings.active_color }} !important;
  }
  
  #shopify-section-{{ section.id }} .bottom-nav__item span {
    margin-top: 2px;
  }

  #shopify-section-{{ section.id }} .bottom-nav__cart-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: {{ section.settings.badge_bg_color }} !important;
    color: {{ section.settings.badge_text_color }} !important;
    border-radius: 50%;
    width: 16px;
    height: 16px;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  #shopify-section-{{ section.id }} .bottom-nav__icon-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
  }
</style>

{% if section.blocks.size > 0 %}
<div class="bottom-nav">
  {% for block in section.blocks %}
    {% case block.type %}
      
      {% when 'link' %}
        <a href="{{ block.settings.url }}" class="bottom-nav__item {% if request.path == block.settings.url %}active{% endif %}" {{ block.shopify_attributes }}>
          <div class="bottom-nav__icon-wrapper">
            {% render 'icon', icon: block.settings.icon %}
          </div>
          <span>{{ block.settings.label }}</span>
        </a>

      {% when 'menu_drawer' %}
        <button is="toggle-button" class="bottom-nav__item" aria-controls="mobile-menu-drawer" aria-expanded="false" {{ block.shopify_attributes }}>
          <div class="bottom-nav__icon-wrapper">
             {% render 'icon', icon: block.settings.icon %}
          </div>
          <span>{{ block.settings.label }}</span>
        </button>

      {% when 'cart_drawer' %}
        <a href="{{ routes.cart_url }}" {% unless settings.cart_type == 'page' or request.page_type == 'cart' %}is="toggle-link" aria-controls="mini-cart" aria-expanded="false"{% endunless %} class="bottom-nav__item" data-no-instant {{ block.shopify_attributes }}>
          <div class="bottom-nav__icon-wrapper">
              {% render 'icon', icon: block.settings.icon %}
              {%- if cart.item_count > 0 -%}
              <div class="bottom-nav__cart-count">{{ cart.item_count }}</div>
              {%- endif -%}
          </div>
          <span>{{ block.settings.label }}</span>
        </a>

      {% when 'account' %}
        <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="bottom-nav__item {% if request.path contains routes.account_url %}active{% endif %}" {{ block.shopify_attributes }}>
          <div class="bottom-nav__icon-wrapper">
              {% render 'icon', icon: block.settings.icon %}
          </div>
          <span>{{ block.settings.label }}</span>
        </a>
        
      {% when 'search_drawer' %}
         {%- unless section.settings.enable_custom_search -%}
            <a href="{{ routes.search_url }}" is="toggle-link" class="bottom-nav__item" aria-controls="search-drawer" aria-expanded="false" aria-label="{{ 'search.general.title' | t | escape }}" {{ block.shopify_attributes }}>
              <div class="bottom-nav__icon-wrapper">
                  {% render 'icon', icon: block.settings.icon %}
              </div>
              <span>{{ block.settings.label }}</span>
            </a>
          {%- endunless -%}

    {% endcase %}
  {% endfor %}
</div>
{% endif %}

{% schema %}
{
  "name": "Bottom Navigation",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable",
      "label": "Enable Bottom Navigation",
      "default": true
    },
    {
      "type": "header",
      "content": "Layout & Sizing"
    },
    {
      "type": "range",
      "id": "height",
      "min": 40,
      "max": 80,
      "step": 1,
      "unit": "px",
      "label": "Bar Height",
      "default": 60
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 16,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Icon Size",
      "default": 24
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Font Size",
      "default": 10
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#e5e5e5"
    },
    {
      "type": "checkbox",
      "id": "show_shadow",
      "label": "Show Shadow",
      "default": true
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
        "type": "color",
        "id": "icon_color",
        "label": "Icon Color",
        "default": "#333333"
      },
    {
      "type": "color",
      "id": "active_color",
      "label": "Active/Hover Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "badge_bg_color",
      "label": "Cart Badge Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Cart Badge Text",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "link",
      "name": "Custom Link",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Link"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link URL"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "picto-store",
          "options": [
            { "value": "home", "label": "Home" },
            { "value": "picto-store", "label": "Store" },
            { "value": "picto-box", "label": "Box" },
            { "value": "picto-like", "label": "Heart" },
            { "value": "picto-gift", "label": "Gift" },
            { "value": "picto-coupon", "label": "Coupon" },
            { "value": "picto-chat", "label": "Chat" },
            { "value": "picto-mobile", "label": "Mobile" },
            { "value": "picto-email", "label": "Email" },
            { "value": "picto-plane", "label": "Plane" },
            { "value": "picto-return-box", "label": "Return Box" },
            { "value": "picto-customer-support", "label": "Support" }
          ]
        }
      ]
    },
    {
      "type": "menu_drawer",
      "name": "Menu Drawer",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Menu"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "header-hamburger",
          "options": [
            { "value": "header-hamburger", "label": "Hamburger" },
            { "value": "filters", "label": "Filters" }
          ]
        }
      ]
    },
    {
      "type": "cart_drawer",
      "name": "Cart Drawer",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Cart"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "header-cart",
          "options": [
            { "value": "header-cart", "label": "Cart" },
            { "value": "header-shopping-cart", "label": "Shopping Cart" },
            { "value": "header-tote-bag", "label": "Tote Bag" },
            { "value": "quick-buy-shopping-bag", "label": "Shopping Bag" }
          ]
        }
      ]
    },
    {
      "type": "account",
      "name": "Account Link",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Account"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "header-customer",
          "options": [
            { "value": "header-customer", "label": "Customer" },
            { "value": "picto-operator", "label": "Operator" }
          ]
        }
      ]
    },
    {
      "type": "search_drawer",
      "name": "Search Drawer",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "Search"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "header-search",
          "options": [
            { "value": "header-search", "label": "Magnifying Glass" }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Bottom Navigation",
      "blocks": [
        {
          "type": "link",
          "settings": {
            "label": "In√≠cio",
            "url": "/",
            "icon": "home"
          }
        },
        {
          "type": "menu_drawer",
          "settings": {
            "label": "Categorias",
            "icon": "header-hamburger"
          }
        },
        {
          "type": "account",
          "settings": {
            "label": "Conta",
            "icon": "header-customer"
          }
        },
        {
          "type": "cart_drawer",
          "settings": {
            "label": "Carrinho",
            "icon": "header-cart"
          }
        }
      ]
    }
  ]
}
{% endschema %}
